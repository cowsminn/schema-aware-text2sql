{"instance_id": "local022", "SQL": "WITH runs_scored AS (\n    SELECT \n        bb.striker AS player_id,\n        bb.match_id,\n        SUM(bs.runs_scored) AS total_runs\n    FROM \n        ball_by_ball AS bb\n    JOIN \n        batsman_scored AS bs ON bb.match_id = bs.match_id AND bb.over_id = bs.over_id AND bb.ball_id = bs.ball_id AND bb.innings_no = bs.innings_no\n    GROUP BY \n        bb.striker, bb.match_id\n),\nplayer_match_info AS (\n    SELECT \n        pm.player_id,\n        pm.match_id,\n        pm.team_id,\n        m.match_winner\n    FROM \n        player_match AS pm\n    JOIN \n        match AS m ON pm.match_id = m.match_id\n)\nSELECT \n    p.player_name\nFROM \n    player AS p\nJOIN \n    runs_scored AS rs ON p.player_id = rs.player_id\nJOIN \n    player_match_info AS pm ON rs.match_id = pm.match_id AND rs.player_id = pm.player_id\nWHERE \n    rs.total_runs >= 100 AND pm.team_id != pm.match_winner"}
{"instance_id": "local163", "SQL": "WITH ranked_faculty AS (\n    SELECT \n        FacRank,\n        FacFirstName,\n        FacLastName,\n        FacSalary,\n        AVG(FacSalary) OVER (PARTITION BY FacRank) AS avg_salary\n    FROM \n        university_faculty\n),\nclosest_to_average AS (\n    SELECT \n        FacRank,\n        FacFirstName,\n        FacLastName,\n        FacSalary,\n        ROW_NUMBER() OVER (PARTITION BY FacRank ORDER BY ABS(FacSalary - avg_salary)) AS row_num\n    FROM \n        ranked_faculty\n)\nSELECT \n    FacRank,\n    FacFirstName,\n    FacLastName,\n    FacSalary\nFROM \n    closest_to_average\nWHERE \n    row_num = 1;"}
{"instance_id": "local065", "SQL": "WITH cleaned_pizza_orders AS (\n    SELECT \n        pco.order_id,\n        pco.customer_id,\n        pco.pizza_id,\n        pco.exclusions,\n        pco.extras,\n        pco.order_time,\n        pro.cancellation\n    FROM \n        pizza_clean_customer_orders pco\n    JOIN \n        pizza_runner_orders pro ON pco.order_id = pro.order_id\n    WHERE \n        pro.cancellation = 'NULL'\n),\npizza_prices AS (\n    SELECT \n        pn.pizza_id,\n        pn.pizza_name,\n        CASE \n            WHEN pn.pizza_name = 'Meat Lovers' THEN 12\n            WHEN pn.pizza_name = 'Vegetarian' THEN 10\n            ELSE 0\n        END AS base_price\n    FROM \n        pizza_names pn\n),\norder_prices AS (\n    SELECT \n        cpo.order_id,\n        cpo.pizza_id,\n        cpo.extras,\n        pp.base_price,\n        pp.base_price + LENGTH(cpo.extras) - LENGTH(REPLACE(cpo.extras, ',', '')) AS total_price\n    FROM \n        cleaned_pizza_orders cpo\n    JOIN \n        pizza_prices pp ON cpo.pizza_id = pp.pizza_id\n)\nSELECT \n    SUM(op.total_price) AS total_income\nFROM \n    order_prices op\nWHERE \n    op.pizza_id IN (SELECT pizza_id FROM pizza_names WHERE pizza_name IN ('Meat Lovers', 'Vegetarian'));"}
{"instance_id": "local078", "SQL": "WITH ranked_interests AS (\n    SELECT \n        im.interest_name,\n        im.id,\n        im.interest_summary,\n        i._month,\n        i._year,\n        i.month_year,\n        i.composition,\n        ROW_NUMBER() OVER (ORDER BY i.composition DESC) AS desc_rank,\n        ROW_NUMBER() OVER (ORDER BY i.composition ASC) AS asc_rank\n    FROM \n        interest_metrics i\n    JOIN \n        interest_map im ON i.interest_id = im.id\n)\nSELECT \n    month_year AS time,\n    interest_name,\n    composition\nFROM \n    ranked_interests\nWHERE \n    desc_rank <= 10 OR asc_rank <= 10\nORDER BY \n    composition DESC;"}
{"instance_id": "local219", "SQL": "WITH team_wins AS (\n    SELECT \n        M.league_id,\n        M.home_team_api_id AS team_api_id,\n        CASE \n            WHEN M.home_team_goal > M.away_team_goal THEN 1 \n            ELSE 0 \n        END AS win\n    FROM \n        Match M\n    UNION ALL\n    SELECT \n        M.league_id,\n        M.away_team_api_id AS team_api_id,\n        CASE \n            WHEN M.away_team_goal > M.home_team_goal THEN 1 \n            ELSE 0 \n        END AS win\n    FROM \n        Match M\n),\nteam_win_counts AS (\n    SELECT \n        league_id,\n        team_api_id,\n        SUM(win) AS total_wins,\n        ROW_NUMBER() OVER (PARTITION BY league_id ORDER BY SUM(win)) AS row_num\n    FROM \n        team_wins\n    GROUP BY \n        league_id, team_api_id\n)\nSELECT \n    L.name AS league_name,\n    T.team_long_name AS team_name,\n    TWC.total_wins\nFROM \n    team_win_counts TWC\nJOIN \n    League L ON TWC.league_id = L.id\nJOIN \n    Team T ON TWC.team_api_id = T.team_api_id\nWHERE \n    TWC.row_num = 1;"}
