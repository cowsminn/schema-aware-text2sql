Evaluating SQL:   0%|          | 0/10 [00:00<?, ?it/s]Evaluating SQL:  10%|#         | 1/10 [00:00<00:03,  2.68it/s]Evaluating SQL:  30%|###       | 3/10 [00:00<00:01,  5.89it/s]Evaluating SQL:  40%|####      | 4/10 [00:01<00:02,  2.85it/s][local003] An error occurred: Execution failed on sql 'WITH CustomerOrderTotals AS (
  SELECT
    c.customer_unique_id,
    o.order_id,
    SUM(oi.price + oi.freight_value) AS total_spend
  FROM customers AS c
  JOIN orders AS o
    ON c.customer_id = o.customer_id
  JOIN order_items AS oi
    ON o.order_id = oi.order_id
  WHERE
    o.order_status = 'delivered'
  GROUP BY
    c.customer_unique_id,
    o.order_id
), CustomerRFM AS (
  SELECT
    customer_unique_id,
    COUNT(order_id) AS Frequency,
    SUM(total_spend) AS MonetaryValue,
    MAX(order_purchase_timestamp) AS last_purchase_date
  FROM CustomerOrderTotals
  JOIN orders
    ON CustomerOrderTotals.order_id = orders.order_id
  GROUP BY
    customer_unique_id
), RFM_Scores AS (
  SELECT
    customer_unique_id,
    Frequency,
    MonetaryValue,
    last_purchase_date,
    DATE('now') AS analysis_date,
    JULIANDAY(DATE('now')) - JULIANDAY(last_purchase_date) AS Recency,
    NTILE(5) OVER (ORDER BY JULIANDAY(DATE('now')) - JULIANDAY(last_purchase_date) DESC) AS R_Score,
    NTILE(5) OVER (ORDER BY COUNT(customer_unique_id) OVER (PARTITION BY customer_unique_id)) AS F_Score,
    NTILE(5) OVER (ORDER BY SUM(MonetaryValue) OVER (PARTITION BY customer_unique_id)) AS M_Score
  FROM CustomerRFM
), RFM_Segments AS (
  SELECT
    customer_unique_id,
    R_Score,
    F_Score,
    M_Score,
    CAST(R_Score AS TEXT) || CAST(F_Score AS TEXT) || CAST(M_Score AS TEXT) AS RFM_Segment
  FROM RFM_Scores
)
SELECT
  RFM_Segment,
  COUNT(DISTINCT r.customer_unique_id) AS num_customers,
  SUM(MonetaryValue) / SUM(Frequency) AS avg_sales_per_order
FROM RFM_Segments AS r
JOIN CustomerRFM AS c
  ON r.customer_unique_id = c.customer_unique_id
GROUP BY
  RFM_Segment
ORDER BY
  RFM_Segment;': ambiguous column name: order_id
Evaluating SQL:  70%|#######   | 7/10 [00:01<00:00,  5.47it/s]Evaluating SQL:  90%|######### | 9/10 [00:02<00:00,  3.63it/s]Evaluating SQL: 100%|##########| 10/10 [00:02<00:00,  3.95it/s]Evaluating SQL: 100%|##########| 10/10 [00:02<00:00,  3.98it/s]
{'local003': 0, 'local004': 1, 'local008': 0, 'local017': 0, 'local019': 0, 'local022': 1, 'local023': 0, 'local029': 1, 'local038': 0, 'local039': 1}
Final score: 0.4, Correct examples: 4, Total examples: 10
Real score: 0.007312614259597806, Correct examples: 4, Total examples: 547
Execution results saved to: /home/cowsmin/Downloads/schema-aware-text2sql/spider2_lite_predictions_csv
Correct IDs saved to: /home/cowsmin/Downloads/schema-aware-text2sql/spider2_lite_predictions-ids.csv
TOTAL_GB_PROCESSED: 0.00000 GB
